const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/IncidentList-DSbaGkQJ.js","assets/index-BYcYhT0r.js","assets/index-0vKgOJBC.css","assets/assetService-DkjO-ceG.js","assets/constants-leaU8Fgz.js","assets/BannerDeviceCanarytools-BaiBoy0l.js","assets/BannerDeviceCanarytools-B9HrAYOX.css","assets/IncidentList-DD3t-pBF.css"])))=>i.map(i=>d[i]);
import{H as J,e as n,h as l,J as de,d as E,I as R,k as o,i as v,R as _e,O as x,V as B,M as h,j as w,v as z,W as ae,q as pe,r as b,K as le,o as X,L as ie,f as C,w as M,X as H,m as q,P as re,l as T,y as K,Y as te,Z as ne,$ as fe,T as P,A as F,a0 as me,a1 as O,a2 as G,u as ue,a3 as U,a4 as ye,D as ge,a as ve,s as he,b as ke,_ as we,c as xe,a5 as be,a6 as Te,n as Ie,a7 as Ce,C as $e,z as Le}from"./index-BYcYhT0r.js";import{B as oe}from"./BannerDeviceCanarytools-BaiBoy0l.js";const Se={},De={class:"grid two-col-grid"};function Me(e,s){return n(),l("div",De,[de(e.$slots,"default")])}const Ee=J(Se,[["render",Me]]),Ne={class:"w-full @container"},Be={class:"flex flex-row items-center flex-1 gap-16"},Pe={class:"text-left"},Oe={key:0,class:"capitalize text-grey-400"},Re={key:1,class:"mr-8 font-semibold"},Ve={class:"flex flex-row items-center justify-end gap-8 mt-8 font-semibold text-red sm:hidden"},je=E({__name:"CardIncident",props:{lastKey:{type:Boolean},incidentPreviewInfo:{},incidentId:{}},emits:["click"],setup(e,{emit:s}){const t=s;function c(){t("click")}return(i,d)=>{const u=R("font-awesome-icon");return n(),l("li",Ne,[o("button",ae(i.$attrs,{class:["relative w-full px-16 py-8 transition duration-100 bg-white border text-grey-700 grouped group rounded-2xl shadow-solid-shadow-grey border-grey-200 error-card",{"mb-8":i.lastKey}],onClick:pe(c,["stop"])}),[o("span",Be,[v(_e,{class:"hidden @xs:block min-w-[30px] group-hover:fill-red group-focus:fill-red group-active:fill-red fill-grey-700 group-hover:scale-95 transition duration-200","aria-hidden":"true"}),o("span",Pe,[(n(!0),l(x,null,B(i.incidentPreviewInfo,(a,y)=>(n(),l("span",{key:y,class:"block"},[a!==null?(n(),l("span",Oe,h(y)+": ",1)):w("",!0),a!==null?(n(),l("span",Re,h(a),1)):w("",!0)]))),128))])]),o("span",Ve,[d[0]||(d[0]=z("Check Incident ")),v(u,{icon:"arrow-right",class:"text-red","aria-hidden":"true"})])],16)])}}}),Ge=J(je,[["__scopeId","data-v-613d45f1"]]),We={key:0},ze={key:1,class:"placeholder-map"},He={class:"font-medium"},Ke={class:"pb-8"},Ue={class:"font-medium"},qe={class:"pt-8"},Fe=E({__name:"CustomMap",props:{hitsList:{}},setup(e){const s=e,t=b(!0),c=b(),i=b(),d=b({lat:-33.9221,lng:18.4231});function u(r){const _=r.split(",");return{lat:parseFloat(_[0]),lng:parseFloat(_[1])}}const a=le(()=>s.hitsList.filter(function(r){return!!r.geo_info}).map(r=>{var _,k,g,p,m;return{id:r.time_of_hit,ip:(_=r.geo_info)==null?void 0:_.ip,hostname:(k=r.geo_info)==null?void 0:k.hostname,city:(g=r.geo_info)==null?void 0:g.city,country:(p=r.geo_info)==null?void 0:p.country,date:H(r.time_of_hit),position:(m=r.geo_info)!=null&&m.loc?u(r.geo_info.loc):void 0}}));X(()=>{if(a.value.length!==0){if(a.value.length>1)return $();a.value.length===1&&a.value[0].position!=null&&(d.value=a.value[0].position)}});function y(r){c.value=r}async function $(){const r=await i.value.$mapPromise,_=new window.google.maps.LatLngBounds;a.value.forEach(k=>{_.extend(k.position)}),r.fitBounds(_)}ie(i,()=>{i.value&&i.value.$mapPromise.then(()=>{t.value=!1})});const L=({count:r,position:_})=>new window.google.maps.Marker({label:{text:`${r}`,color:"white",fontWeight:"600"},icon:{url:q("icons/map-cluster-pin.png"),scaledSize:{width:40,height:40}},position:_,zIndex:1e3+r}),I={zoomControl:!0,mapTypeControl:!1,streetViewControl:!1,rotateControl:!0,fullscreenControl:!1,styles:[{featureType:"administrative.country",elementType:"geometry.stroke",stylers:[{lightness:"52"}]},{featureType:"administrative.country",elementType:"labels.text.fill",stylers:[{lightness:"60"}]},{featureType:"administrative.province",elementType:"labels.text.fill",stylers:[{lightness:"24"}]},{featureType:"administrative.locality",elementType:"labels.text.fill",stylers:[{lightness:"29"}]},{featureType:"administrative.locality",elementType:"labels.icon",stylers:[{lightness:"47"},{hue:"#ff0000"}]},{featureType:"landscape",elementType:"all",stylers:[{saturation:13.400000000000006},{lightness:57.599999999999994},{gamma:1}]},{featureType:"poi",elementType:"all",stylers:[{saturation:-1.0989010989011234},{lightness:11.200000000000017},{gamma:1}]},{featureType:"road.highway",elementType:"all",stylers:[{saturation:-61.8},{lightness:45.599999999999994},{gamma:1}]},{featureType:"road.arterial",elementType:"all",stylers:[{saturation:-100},{lightness:51.19999999999999},{gamma:1}]},{featureType:"road.local",elementType:"all",stylers:[{saturation:-100},{lightness:52},{gamma:1}]},{featureType:"water",elementType:"all",stylers:[{saturation:-13.200000000000003},{lightness:2.4000000000000057},{gamma:1}]},{featureType:"water",elementType:"geometry.fill",stylers:[{lightness:"38"},{saturation:"-55"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{lightness:"65"},{saturation:"52"}]}]};return(r,_)=>{const k=re,g=R("GMapInfoWindow"),p=R("GMapMarker"),m=R("GMapCluster"),S=R("GMapMap");return n(),l(x,null,[t.value?(n(),l("div",We,[v(k,{type:"rectangle",class:"md:h-[40svh] h-[30svh]"})])):w("",!0),!t.value&&r.hitsList.length===0?(n(),l("div",ze)):(n(),C(S,ae({key:2},r.$attrs,{ref_key:"mapRef",ref:i,zoom:6,center:d.value,"map-type-id":"terrain",class:"grid-areas rounded-2xl",options:I}),{default:M(()=>[v(m,{renderer:{render:L},"zoom-on-click":!0},{default:M(()=>[(n(!0),l(x,null,B(a.value,(f,N)=>(n(),C(p,{key:N,position:f.position,clickable:!0,icon:{url:T(q)("icons/map-pin.png"),scaledSize:{width:60,height:60},labelOrigin:{x:16,y:-60}},onClick:D=>y(f.id)},{default:M(()=>[v(g,{closeclick:!0,opened:c.value===f.id,class:"px-8 py-8",onCloseclick:_[0]||(_[0]=D=>y(null))},{default:M(()=>{var D,V;return[o("ul",null,[o("li",null,[_[1]||(_[1]=z(" From IP: ")),o("span",He,h(f.ip),1)]),o("li",Ke,h(f.hostname),1),o("li",Ue,h(f.date),1),o("li",qe,h(f.city)+", "+h(f.country),1),o("li",null," Lat: "+h(((D=f.position)==null?void 0:D.lat)||"")+", Lng: "+h(((V=f.position)==null?void 0:V.lng)||""),1)])]}),_:2},1032,["opened"])]),_:2},1032,["position","icon","onClick"]))),128))]),_:1},8,["renderer"])]),_:1},16,["center"]))],64)}}}),Ye={class:"block text-xs uppercase text-grey-500"},W=E({__name:"IncidentDetailsListItem",props:{label:{},value:{type:[String,Boolean,Number]}},setup(e){function s(t){if(typeof t=="boolean")return t?"text-green":"text-red"}return(t,c)=>(n(),l("li",null,[o("span",Ye,h(t.label),1),o("span",{class:K(s(t.value))},h(t.value),3)]))}}),Je={class:"p-16 text-white rounded-md bg-red"},Xe={class:"flex flex-col justify-between gap-24 mt-16 md:flex-row"},Ze={class:"flex flex-col gap-2"},Qe={class:"font-semibold"},Ae={key:0,class:"flex flex-col gap-2"},et={class:"font-semibold"},tt={key:1,class:"flex flex-col gap-2"},nt={class:"font-semibold"},ot=E({__name:"IncidentDetailsSummary",props:{date:{},ip:{},inputChannel:{}},setup(e){return(s,t)=>(n(),l("section",Je,[t[3]||(t[3]=o("h2",{class:"font-semibold"},"Incident info",-1)),o("ul",Xe,[o("li",Ze,[t[0]||(t[0]=o("span",{class:"text-xs text-red-100"},"Date",-1)),o("span",Qe,h(s.date)+"Â ",1)]),s.ip?(n(),l("li",Ae,[t[1]||(t[1]=o("span",{class:"text-xs text-red-100"},"IP",-1)),o("span",et,h(s.ip),1)])):w("",!0),s.inputChannel?(n(),l("li",tt,[t[2]||(t[2]=o("span",{class:"text-xs text-red-100"},"Channel",-1)),o("span",nt,h(s.inputChannel),1)])):w("",!0)])]))}});function st(e,s){return te.hasOwnProperty(s)?te[s]:e}function Y(e){try{return Object.entries(e).reduce((s,[t,c])=>{const i=ne.hasOwnProperty(t)?ne[t]:fe(t);return typeof c=="object"&&c!==null?s[i]=Y(c):s[i]=c,s},{})}catch(s){return console.error(`Error in formatting labels: ${s}`),e}}function at(e){const s=Object.values(P).find(t=>t===e);return s?F[s].label:e}function lt(e){return e.geo_info==null?null:e.geo_info.bogon?{ip:e.geo_info.ip,bogon:e.geo_info.bogon}:{...e.geo_info}}function se(e,s){var i,d,u,a,y,$,L,I,r,_,k,g,p,m,S,f,N,D,V,Z,Q,A,ee;const t={token_type:at(e.token_type),input_channel:st(e.input_channel,e.token_type),src_data:e.src_data,useragent:e.useragent||null,last4:e.last4||null,amount:e.amount||null,merchant:e.merchant||null,mail:e.mail||null,referer:e.referer||e.referrer||null,request_args:(e==null?void 0:e.request_args)||null},c={time_of_hit:H(e.time_of_hit),src_ip:e.src_ip,geo_info:lt(e)};switch(s){case P.AWS_KEYS:return{basic_info:{...t,location:e.location?e.location:null},...c,is_tor_relay:e.is_tor_relay,additional_info:{...e.additional_info,aws_key_log_data:e.additional_info.aws_key_log_data?{last_used:e.additional_info.aws_key_log_data.last_used?me(e.additional_info.aws_key_log_data.last_used):null,service_used:e.additional_info.aws_key_log_data.service_used,eventName:((i=e.additional_info.aws_key_log_data)==null?void 0:i.eventName)??null}:null}};case P.CREDIT_CARD_V2:return{basic_info:{...t,location:e.location?e.location:null},time_of_hit:H(e.time_of_hit),is_tor_relay:null,additional_info:{...e.additional_info,aws_key_log_data:null}};case P.PWA:let ce=function(j){return typeof j=="string"?j:j.coords!==null?j.coords:j};return{basic_info:{...t,location:e.location?ce(e.location):null},...c,is_tor_relay:e.is_tor_relay,additional_info:{...e.additional_info,aws_key_log_data:null}};case P.AWS_INFRA:return{basic_info:{...t,location:e.location?e.location:null},...c,is_tor_relay:null,event:{eventName:((u=(d=e.additional_info)==null?void 0:d.event)==null?void 0:u["Event Name"])||null,eventTime:(y=(a=e.additional_info)==null?void 0:a.event)==null?void 0:y["Event Time"],accountAndRegion:(L=($=e.additional_info)==null?void 0:$.event)==null?void 0:L["Account & Region"]},decoy_resource:{asset_type:((r=(I=e.additional_info)==null?void 0:I.decoy_resource)==null?void 0:r.asset_type)||null,request_parameters:((k=(_=e.additional_info)==null?void 0:_.decoy_resource)==null?void 0:k["Request Parameters"])||null},identity:{userIdentity:((p=(g=e.additional_info)==null?void 0:g.identity)==null?void 0:p["User Identity"])||null,userAgent:((S=(m=e.additional_info)==null?void 0:m.identity)==null?void 0:S.UserAgent)||null},metadata:{eventId:((N=(f=e.additional_info)==null?void 0:f.metadata)==null?void 0:N["Event ID"])||null,readOnlyEvent:((V=(D=e.additional_info)==null?void 0:D.metadata)==null?void 0:V["ReadOnly Event"])||null,eventCategory:((Q=(Z=e.additional_info)==null?void 0:Z.metadata)==null?void 0:Q["Event Category"])||null,classification:((ee=(A=e.additional_info)==null?void 0:A.metadata)==null?void 0:ee.Classification)||null}};default:return{basic_info:{...t,location:e.location?e.location:null},...c,is_tor_relay:e.is_tor_relay,additional_info:{...e.additional_info,aws_key_log_data:null}}}}const it={class:"sticky top-[0px] bg-white h-[4rem] sm:h-40 flex justify-end"},rt={class:"px-16"},ut={class:"grid md:grid-cols-[auto_1fr] gap-32 mt-32 pl-8"},ct={key:0,class:"text-grey-500"},dt={key:1,class:"flex flex-col gap-16 pb-16 [&:not(:last-child)]:border-b md:ml-32 border-grey-100"},_t={key:0,class:"break-words"},pt={key:1},ft={class:"text-grey-500"},mt=E({__name:"IncidentDetails",props:{hitAlert:{},showingMap:{type:Boolean,default:!0},tokenType:{}},emits:["close"],setup(e,{emit:s}){const t=e,c=s,i=b(null),d=b({}),u=a=>"src_ip"in a?a.src_ip:null;return X(()=>{i.value=se(t.hitAlert,t.tokenType),d.value=Y(i.value)}),ie(()=>t.hitAlert,()=>{i.value=se(t.hitAlert,t.tokenType),d.value=Y(i.value)}),(a,y)=>{var L;const $=R("font-awesome-icon");return n(),l("div",{class:K(["pb-32 bg-white rounded-3xl",{"sm:m-8":t.showingMap,"border shadow-solid-shadow-grey border-grey-100":!t.showingMap}])},[o("div",it,[t.showingMap?(n(),l("button",{key:0,type:"button",class:"px-16",onClick:y[0]||(y[0]=I=>c("close"))},[v($,{icon:"xmark",class:"w-24 h-24 sm:w-16 sm:h-16 text-grey-400 hover:text-grey-200"})])):w("",!0)]),o("div",rt,[i.value?(n(),C(ot,{key:0,date:(L=i.value)==null?void 0:L.time_of_hit,ip:u(i.value),"input-channel":i.value.basic_info.input_channel},null,8,["date","ip","input-channel"])):w("",!0),o("section",ut,[(n(!0),l(x,null,B(d.value,(I,r)=>(n(),l(x,{key:r},[T(O)(r)&&T(O)(I)?(n(),l("h3",ct,h(r)+": ",1)):w("",!0),T(O)(I)?(n(),l("ul",dt,[T(G)(I)?(n(!0),l(x,{key:1},B(I,(_,k)=>(n(),l(x,{key:k},[T(O)(_)?(n(),l("ul",_t,[T(G)(_)?(n(),l("ul",pt,[o("h3",ft,h(k)+":",1),(n(!0),l(x,null,B(_,(g,p)=>(n(),l(x,{key:p},[!T(G)(g)&&T(O)(g)?(n(),C(W,{key:0,label:p,value:g,class:"py-8 ml-24"},null,8,["label","value"])):(n(!0),l(x,{key:1},B(g,(m,S)=>(n(),l(x,{key:S},[!T(G)(m)&&T(O)(m)?(n(),C(W,{key:0,label:p,value:m,class:"py-8 ml-24"},null,8,["label","value"])):w("",!0)],64))),128))],64))),128))])):(n(),C(W,{key:0,label:k,value:_},null,8,["label","value"]))])):w("",!0)],64))),128)):(n(),C(W,{key:0,value:I},null,8,["value"]))])):w("",!0)],64))),128))])])],2)}}}),yt=J(mt,[["__scopeId","data-v-30dcc552"]]),gt={class:"flex flex-row flex-wrap items-center justify-between px-16 py-8 mb-8 bg-white border rounded-2xl border-grey-100"},vt={class:"flex flex-row"},ht=E({__name:"AlertsListDownload",setup(e){const s=ue(),t=b(!1),c=b(!1);function i(d){d===U.CSV?t.value=!0:c.value=!0;const u={fmt:d,auth:s.params.auth,token:s.params.token};ye(u).then(a=>{window.location.href=a.request.responseURL}).catch(a=>{console.log(a,"err")}).finally(()=>{t.value=!1,c.value=!1,console.log("You downloaded the file, yay!")})}return(d,u)=>{const a=ge;return n(),l("li",gt,[u[4]||(u[4]=o("p",{class:"text-sm text-grey-500"},"Download list",-1)),o("div",vt,[v(a,{variant:"text",icon:"file",loading:t.value,onClick:u[0]||(u[0]=y=>i(T(U).CSV))},{default:M(()=>u[2]||(u[2]=[z("CSV")])),_:1},8,["loading"]),v(a,{variant:"text",icon:"file-excel",loading:c.value,onClick:u[1]||(u[1]=y=>i(T(U).JSON))},{default:M(()=>u[3]||(u[3]=[z("JSON")])),_:1},8,["loading"])])])}}}),kt={class:"flex flex-col gap-16 mx-16 mt-[60px]"},wt={class:"flex flex-col gap-16 mt-[60px]"},xt={class:"flex flex-col h-full gap-16 pb-16"},bt={key:0,class:"flex flex-col items-center justify-center flex-grow px-16 py-16 align-middle"},Tt=["src"],It=E({__name:"HistoryToken",emits:["update-token-title"],setup(e,{emit:s}){const t=s,c=ue(),i=ve(),d=b(!1),u=b(!1),a=b(),y=b(),$=b(),L=he(),I=le(()=>[P.AWS_INFRA].includes($.value));X(async()=>{if(await r(),I.value)try{d.value=!0,L.value=ke(()=>we(Object.assign({"./tokens/aws_infra/history/IncidentList.vue":()=>xe(()=>import("./IncidentList-DSbaGkQJ.js"),__vite__mapDeps([0,1,2,3,4,5,6,7]))}),`./tokens/${$.value}/history/IncidentList.vue`,5)),await L.value.__asyncLoader(),d.value=!1}catch(g){console.error(g),u.value=!0,d.value=!1}});async function r(){d.value=!0;const g={auth:c.params.auth,token:c.params.token};try{const m=await(await be(g)).data;a.value=m.history.hits.sort((S,f)=>f.time_of_hit-S.time_of_hit),$.value=m.history.token_type,t("update-token-title",m.history.token_type,c.params.token),!k()&&a.value.length>0&&_(a.value[0])}catch(p){console.log(p,"err!"),u.value=p.toString(),i.push({name:"error"})}finally{d.value=!1}}async function _(g){await Te(()=>{y.value=g;const p=document.getElementById("incident_detail");p?p.scrollTo({top:0,behavior:"smooth"}):window.scrollTo({top:0,behavior:"smooth"})})}function k(){return![P.CREDIT_CARD_V2].includes($.value)}return(g,p)=>{const m=re,S=$e;return n(),l(x,null,[d.value?(n(),l(x,{key:0},[o("div",kt,[v(m,{type:"header",class:"w-[200px]"}),v(m,{class:"h-[10vh]"}),v(m,{class:"h-[10vh]"}),v(m,{class:"h-[10vh]"})]),o("div",wt,[v(m,{class:"h-[50svh] w-full"}),v(m,{class:"h-[20svh] w-full"})])],64)):w("",!0),a.value?(n(),l(x,{key:1},[o("div",{id:"alerts-card-list",class:K(["flex-col md:p-16 md:bg-grey-50 md:rounded-3xl md:overflow-scroll md:max-h-[70svh]",{"hidden md:block":y.value}])},[o("ul",xt,[p[3]||(p[3]=o("h2",{class:"font-semibold leading-5 text-grey-800"},"Alerts list",-1)),a.value.length===0?(n(),l("li",bt,[p[2]||(p[2]=o("p",{class:"text-xl text-center text-grey-400"}," There are no alerts for this Canarytoken. ",-1)),o("img",{src:T(q)("token_icons/default.png"),alt:"No alerts",class:"grayscale opacity-50 w-[50%] not-sr-only group-hover:opacity-100 sm:block mt-16"},null,8,Tt)])):(n(),C(ht,{key:1})),u.value?(n(),C(S,{key:2,variant:"danger",message:"Oh no! Something went wrong. Please refresh the page or try again later."})):w("",!0),I.value?(n(),C(Ie(L.value),{key:3,"hits-list":a.value,onSelectAlert:p[0]||(p[0]=f=>_(f))},null,40,["hits-list"])):(n(!0),l(x,{key:4},B(a.value,(f,N)=>(n(),C(Ge,{key:N,x:"","last-key":N===a.value.length-1,"incident-id":f.time_of_hit,"incident-preview-info":{Date:T(H)(f.time_of_hit),IP:f.src_ip,Channel:f.input_channel},onClick:D=>_(f)},null,8,["last-key","incident-id","incident-preview-info","onClick"]))),128)),v(oe,{class:"flex md:hidden"})])],2),o("div",null,[o("div",{class:K(["@md:relative md:h-[45svh] h-[30svh]",a.value.length===0?"hidden sm:grid":"grid"])},[v(Ce,{name:"slide-fade"},{default:M(()=>[y.value?(n(),C(yt,{key:0,id:"incident_detail","showing-map":k(),"hit-alert":y.value,class:"absolute top-[120px] left-[0] md:top-[0px] md:relative grid-areas z-10 md:overflow-scroll w-full sm:w-auto","token-type":$.value,onClose:p[1]||(p[1]=f=>y.value=null)},null,8,["showing-map","hit-alert","token-type"])):w("",!0)]),_:1}),k()?(n(),C(Fe,{key:0,"hits-list":a.value},null,8,["hits-list"])):w("",!0)],2),v(oe,{class:"hidden md:flex"})])],64)):w("",!0)],64)}}}),Ct={key:0,class:"flex flex-col items-center gap-8 mt-16"},$t={class:"mb-24 text-xl text-center text-grey-500"},Lt={class:"text-grey-300"},St={class:"font-semibold"},Dt=E({__name:"HistoryView",setup(e){const s=b(""),t=b(""),c=b("");function i(d,u){s.value=F[d].label,c.value=F[d].icon,t.value=u}return(d,u)=>(n(),l(x,null,[s.value&&t.value&&c.value?(n(),l("div",Ct,[v(Le,{title:s.value,"logo-img-url":c.value,class:"h-[4rem] w-[4rem]","has-shadow":!1},null,8,["title","logo-img-url"]),o("div",$t,[o("h2",null,[o("span",Lt,h(s.value)+" Canarytoken ID: ",1),o("span",St,h(t.value),1)])])])):w("",!0),v(Ee,null,{default:M(()=>[v(It,{onUpdateTokenTitle:u[0]||(u[0]=(a,y)=>i(a,y))})]),_:1})],64))}}),Nt=Object.freeze(Object.defineProperty({__proto__:null,default:Dt},Symbol.toStringTag,{value:"Module"}));export{Ge as C,Nt as H};
