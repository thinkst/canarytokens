import{d as M,a as R,r as c,o as V,L as b,aD as P,e as n,h as S,k as s,M as q,f as p,j as m,i as I,z as H,l as C,m as O,w as g,v as h,D as W,T as $,H as G}from"./index-BDTIPFyt.js";import{_ as j}from"./BaseCodeSnippet.vue_vue_type_script_setup_true_lang-BuloFzfN.js";import{c as B}from"./awsInfra-DuYOQ03w.js";import{_ as z}from"./StepState.vue_vue_type_script_setup_true_lang-DAe_izlq.js";import"./BaseCopyButton-B8ekOA3d.js";const F={class:"section-terraform-snippet flex flex-col items-center"},K={class:"infra-token__title-wrapper text-center"},U={key:1},Y={class:"flex flex-col items-center pt-16"},J={class:"relative"},Q=["src"],X={class:"flex flex-row mt-40 gap-16"},Z=M({__name:"GenerateTerraformSnippet",props:{initialStepData:{}},emits:["updateStep","storeCurrentStepData"],setup(D,{emit:L}){const N=L,A=D,T=R(),t=c(!0),a=c(!1),l=c(!1),o=c(""),k=c(""),{token:d,auth_token:f}=A.initialStepData;V(async()=>{await y()});async function y(){t.value=!0,a.value=!1,l.value=!1;try{const e=await B({canarytoken:d,auth_token:f});e.status!==200&&(t.value=!1,a.value=!0,o.value=e.data.message);const _=e.data.handle,i=Date.now(),w=5*60*1e3,u=setInterval(async()=>{try{const r=await B({handle:_});if(r.status!==200){t.value=!1,a.value=!0,o.value=r.data.error||"Error on requesting the Terraform Snippet",clearInterval(u);return}if(r.data.message){t.value=!1,a.value=!0,o.value=r.data.message,clearInterval(u);return}if(Date.now()-i>=w){a.value=!0,o.value="The operation took too long. Try again.",clearInterval(u);return}if(r.data.terraform_module_snippet){t.value=!1,l.value=!0;const x=r.data.terraform_module_snippet;k.value=x,N("storeCurrentStepData",{token:d,auth_token:f,terraform_module_snippet:x}),clearInterval(u);return}}catch(r){a.value=!0,o.value=r.message||"An error occurred while checking the Role. Try again",clearInterval(u);return}finally{t.value=!1}},5e3)}catch(e){a.value=!0,o.value=e.message,l.value=!1}}function E(){T.push({name:"manage",params:{auth:f,token:d}})}return b(l,v=>{v===!0&&P($.AWS_INFRA,".section-terraform-snippet")}),(v,e)=>{const _=j,i=W;return n(),S("section",F,[s("div",K,[s("h2",null,q(t.value||a.value?"Preparing the Terraform module...":"Terraform Module"),1)]),t.value||a.value?(n(),p(z,{key:0,"is-loading":t.value,"is-error":a.value,"loading-message":"We are generating the terraform module, hold on","error-message":o.value},null,8,["is-loading","is-error","error-message"])):m("",!0),l.value?(n(),S("div",U,[e[1]||(e[1]=s("h3",{class:"text-center"}," Add this module to your code and run ``terraform init`` ",-1)),I(_,{lang:"bash",label:"Terraform module",code:k.value,class:"mt-40 md:max-w-[600px] max-w-[350px] wrap-code","custom-height":"150px"},null,8,["code"]),s("div",Y,[s("div",J,[I(H,{title:"aws infra token","logo-img-url":"aws_infra.png","has-shadow":!0,class:"w-[6rem]"}),s("img",{alt:"active token",src:C(O)("icons/active_token_badge.png"),class:"absolute top-[4.5rem] left-[4rem] w-[1.5rem]"},null,8,Q)])]),e[2]||(e[2]=s("h2",{class:"mt-24 text-center"}," Thatâ€™s it! Any attempts to interact with the decoy assets will generate an alert. ",-1))])):m("",!0),s("div",X,[t.value?m("",!0):(n(),p(i,{key:0,variant:"secondary",onClick:e[0]||(e[0]=w=>C(T).push("/"))},{default:g(()=>e[3]||(e[3]=[h(" Back Home")])),_:1})),t.value?m("",!0):(n(),p(i,{key:1,variant:"secondary",onClick:E},{default:g(()=>e[4]||(e[4]=[h(" Manage Token")])),_:1}))]),a.value?(n(),p(i,{key:2,class:"mt-40",variant:"secondary",onClick:y},{default:g(()=>e[5]||(e[5]=[h(" Try again ")])),_:1})):m("",!0)])}}}),ne=G(Z,[["__scopeId","data-v-94c293cd"]]);export{ne as default};
