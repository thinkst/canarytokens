import{d as E,r as u,L as A,e as r,h as v,k as m,i as h,l as y,A as k,z as $,m as M,j as d,f as w,C as N,p as R}from"./index-DatEjxfX.js";import{_ as V}from"./BaseCodeSnippet.vue_vue_type_script_setup_true_lang-BRMUtiF-.js";import{d as T}from"./awsInfra-GRFw5Phc.js";import"./BaseCopyButton-BKqjxG5T.js";const q={class:"flex flex-col items-stretch justify-center w-full"},O={class:"flex flex-col items-center justify-center"},P={class:"relative mb-16"},W=["src","alt"],j={key:0,class:"text-center"},F={key:1,class:"mt-16"},z={key:2,class:"text-center mt-16 flex flex-col items-center"},Q=E({__name:"DeleteTokenModal",props:{auth:{},token:{},type:{},closeModal:{type:Function},triggerDeleteToken:{type:Boolean}},emits:["tokenDeleted","closeModal"],setup(x,{emit:I}){const l=x,b=I,e=u(!1),s=u(""),a=u(!1),c=u(!1),f=u("");async function C(){a.value=!0,e.value=!1;try{const t=await T({canarytoken:l.token,auth_token:l.auth});if(t.status!==200){a.value=!1,e.value=!0,s.value=t.data.message||"Error on requesting to delete the token. Try again";return}const p=t.data.handle,g=Date.now(),_=5*60*1e3,i=setInterval(async()=>{try{const o=await T({handle:p});if(o.status!==200){a.value=!1,e.value=!0,s.value=o.data.message||"Error on requesting to delete the token. Try again",clearInterval(i);return}if(o.data.message){a.value=!1,e.value=!0,s.value=o.data.message,clearInterval(i);return}if(Date.now()-g>=_){a.value=!1,e.value=!0,s.value="The operation took too long. Try again.",clearInterval(i);return}if(o.data.result===!0){a.value=!1,c.value=!0,e.value=!1;const L=o.data.role_cleanup_commands.customer_aws_account,S=o.data.role_cleanup_commands.role_name,B=D(L,S);f.value=B,clearInterval(i),b("tokenDeleted");return}}catch{e.value=!0,s.value="Error on requesting to delete the token. Try again",clearInterval(i);return}},5e3)}catch{a.value=!1,e.value=!0,s.value="Error on requesting to delete the token. Try again",c.value=!1}}function D(n,t){return`aws iam detach-role-policy --role-name ${t} --policy-arn arn:aws:iam::${n}:policy/Canarytokens-Inventory-ReadOnly-Policy

aws iam delete-policy --policy-arn arn:aws:iam::${n}:policy/Canarytokens-Inventory-ReadOnly-Policy

aws iam delete-role --role-name  ${t}`}return A(()=>l.triggerDeleteToken,n=>{n===!0&&C()}),(n,t)=>{const p=N,g=V,_=R;return r(),v("div",q,[m("div",O,[m("span",P,[h($,{title:y(k)[l.type].label,"logo-img-url":y(k)[l.type].icon,class:"h-[6rem] w-[6rem]","has-shadow":!0,"has-animation":!0},null,8,["title","logo-img-url"]),m("img",{src:y(M)("token_icons/delete_token_badge.png"),alt:`${y(k)[l.type].label}`,class:"absolute w-[1.3rem] bottom-[.5rem] right-[.3rem]"},null,8,W)])]),!a.value&&!c.value?(r(),v("div",j,t[0]||(t[0]=[m("p",{class:"text-xl font-semibold leading-normal text-grey-800"}," Are you sure you want to delete this Canarytoken? ",-1),m("p",{class:"mt-8 leading-normal text-normal text-grey-500"}," All associated alerts will be permanently lost ",-1)]))):d("",!0),c.value?(r(),v("div",F,[h(p,{variant:"success",message:"The token was deleted successfully. Run the AWS CLI snippet below to remove the role and policy from your AWS account."}),f.value?(r(),w(g,{key:0,lang:"bash",label:"AWS CLI snippet",code:f.value,"custom-height":"100px",class:"mt-24 wrap-code"},null,8,["code"])):d("",!0)])):d("",!0),a.value&&!e.value?(r(),v("div",z,[h(_,{height:"3rem"})])):d("",!0),e.value&&!c.value?(r(),w(p,{key:3,variant:"danger",class:"mt-16",message:s.value},null,8,["message"])):d("",!0)])}}});export{Q as default};
