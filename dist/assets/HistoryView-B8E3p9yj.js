import{y as Y,a as s,c as l,A as le,d as D,z as E,f as o,i as _,O as ae,I as g,P as M,E as m,e as v,h as G,Q as A,w as ie,r as x,o as F,C as re,D as ee,b,j as L,R as H,g as W,K as te,u as w,n as R,V as q,W as ue,X,T as N,t as K,Y as j,B as ne,Z as z,$ as ce,q as de,k as pe,a0 as fe,a1 as _e,a2 as me,p as ye,l as ge}from"./index-BWqoNE0f.js";import{B as Q}from"./BannerDeviceCanarytools-D1XhtivD.js";const he={},ve={class:"grid two-col-grid"};function xe(e,t){return s(),l("div",ve,[le(e.$slots,"default")])}const we=Y(he,[["render",xe]]),ke={class:"w-full @container"},be={class:"flex flex-row items-center flex-1 gap-16"},Te={class:"text-left"},$e={key:0,class:"capitalize text-grey-400"},Ce={key:1,class:"mr-8 font-semibold"},Ie={class:"flex flex-row items-center justify-end gap-8 mt-8 font-semibold text-red sm:hidden"},Le=D({__name:"CardIncident",props:{lastKey:{type:Boolean},incidentPreviewInfo:{},incidentId:{}},emits:["click"],setup(e,{emit:t}){const n=t;function u(){n("click")}return(r,f)=>{const c=E("font-awesome-icon");return s(),l("li",ke,[o("button",A(r.$attrs,{class:["relative w-full px-16 py-8 transition duration-100 bg-white border text-grey-700 grouped group rounded-2xl shadow-solid-shadow-grey border-grey-200 error-card",{"mb-8":r.lastKey}],onClick:ie(u,["stop"])}),[o("span",be,[_(ae,{class:"hidden @xs:block min-w-[30px] group-hover:fill-red group-focus:fill-red group-active:fill-red fill-grey-700 group-hover:scale-95 transition duration-200","aria-hidden":"true"}),o("span",Te,[(s(!0),l(g,null,M(r.incidentPreviewInfo,(a,y)=>(s(),l("span",{key:y,class:"block"},[a!==null?(s(),l("span",$e,m(y)+": ",1)):v("",!0),a!==null?(s(),l("span",Ce,m(a),1)):v("",!0)]))),128))])]),o("span",Ie,[f[0]||(f[0]=G("Check Incident ")),_(c,{icon:"arrow-right",class:"text-red","aria-hidden":"true"})])],16)])}}}),De=Y(Le,[["__scopeId","data-v-fd02fb4f"]]),Se={key:0},Me={key:1,class:"placeholder-map"},Be={class:"font-medium"},Ee={class:"pb-8"},Ne={class:"font-medium"},Pe={class:"pt-8"},Oe=D({__name:"CustomMap",props:{hitsList:{}},setup(e){const t=e,n=x(!0),u=x(),r=x(),f=x({lat:0,lng:0});function c(i){const d=i.split(",");return{lat:parseFloat(d[0]),lng:parseFloat(d[1])}}F(()=>{if(t.hitsList.length!==0){if(t.hitsList.length>1)return S();t.hitsList.length===1&&(f.value=c(t.hitsList[0].geo_info.loc))}});const a=re(()=>t.hitsList.map(i=>({id:i.time_of_hit,ip:i.geo_info.ip,hostname:i.geo_info.hostname,city:i.geo_info.city,country:i.geo_info.country,date:H(i.time_of_hit),position:i.geo_info.loc?c(i.geo_info.loc):void 0})));function y(i){u.value=i}async function S(){const i=await r.value.$mapPromise,d=new window.google.maps.LatLngBounds;a.value.forEach(p=>{d.extend(p.position)}),i.fitBounds(d)}ee(r,()=>{r.value&&r.value.$mapPromise.then(()=>{n.value=!1})});const $=({count:i,position:d})=>new window.google.maps.Marker({label:{text:`${i}`,color:"white",fontWeight:"600"},icon:{url:W("icons/map-cluster-pin.png"),scaledSize:{width:40,height:40}},position:d,zIndex:1e3+i}),I={zoomControl:!0,mapTypeControl:!1,streetViewControl:!1,rotateControl:!0,fullscreenControl:!1,styles:[{featureType:"administrative.country",elementType:"geometry.stroke",stylers:[{lightness:"52"}]},{featureType:"administrative.country",elementType:"labels.text.fill",stylers:[{lightness:"60"}]},{featureType:"administrative.province",elementType:"labels.text.fill",stylers:[{lightness:"24"}]},{featureType:"administrative.locality",elementType:"labels.text.fill",stylers:[{lightness:"29"}]},{featureType:"administrative.locality",elementType:"labels.icon",stylers:[{lightness:"47"},{hue:"#ff0000"}]},{featureType:"landscape",elementType:"all",stylers:[{saturation:13.400000000000006},{lightness:57.599999999999994},{gamma:1}]},{featureType:"poi",elementType:"all",stylers:[{saturation:-1.0989010989011234},{lightness:11.200000000000017},{gamma:1}]},{featureType:"road.highway",elementType:"all",stylers:[{saturation:-61.8},{lightness:45.599999999999994},{gamma:1}]},{featureType:"road.arterial",elementType:"all",stylers:[{saturation:-100},{lightness:51.19999999999999},{gamma:1}]},{featureType:"road.local",elementType:"all",stylers:[{saturation:-100},{lightness:52},{gamma:1}]},{featureType:"water",elementType:"all",stylers:[{saturation:-13.200000000000003},{lightness:2.4000000000000057},{gamma:1}]},{featureType:"water",elementType:"geometry.fill",stylers:[{lightness:"38"},{saturation:"-55"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{lightness:"65"},{saturation:"52"}]}]};return(i,d)=>{const p=te,h=E("GMapInfoWindow"),C=E("GMapMarker"),k=E("GMapCluster"),P=E("GMapMap");return s(),l(g,null,[n.value?(s(),l("div",Se,[_(p,{type:"rectangle",class:"md:h-[40svh] h-[30svh]"})])):v("",!0),!n.value&&i.hitsList.length===0?(s(),l("div",Me)):(s(),b(P,A({key:2},i.$attrs,{ref_key:"mapRef",ref:r,zoom:6,center:f.value,"map-type-id":"terrain",class:"grid-areas rounded-2xl",options:I}),{default:L(()=>[_(k,{renderer:{render:$},"zoom-on-click":!0},{default:L(()=>[(s(!0),l(g,null,M(a.value,(T,oe)=>(s(),b(C,{key:oe,position:T.position,clickable:!0,icon:{url:w(W)("icons/map-pin.png"),scaledSize:{width:60,height:60},labelOrigin:{x:16,y:-60}},onClick:O=>y(T.id)},{default:L(()=>[_(h,{closeclick:!0,opened:u.value===T.id,class:"px-8 py-8",onCloseclick:d[0]||(d[0]=O=>y(null))},{default:L(()=>{var O,J;return[o("ul",null,[o("li",null,[d[1]||(d[1]=G(" From IP: ")),o("span",Be,m(T.ip),1)]),o("li",Ee,m(T.hostname),1),o("li",Ne,m(T.date),1),o("li",Pe,m(T.city)+", "+m(T.country),1),o("li",null," Lat: "+m(((O=T.position)==null?void 0:O.lat)||"")+", Lng: "+m(((J=T.position)==null?void 0:J.lng)||""),1)])]}),_:2},1032,["opened"])]),_:2},1032,["position","icon","onClick"]))),128))]),_:1},8,["renderer"])]),_:1},16,["center"]))],64)}}}),je={class:"block text-xs uppercase text-grey-500"},V=D({__name:"IncidentDetailsListItem",props:{label:{},value:{type:[String,Boolean,Number]}},setup(e){function t(n){if(typeof n=="boolean")return n?"text-green":"text-red"}return(n,u)=>(s(),l("li",null,[o("span",je,m(n.label),1),o("span",{class:R(t(n.value))},m(n.value),3)]))}}),Ve={class:"p-16 text-white rounded-md bg-red"},Ge={class:"flex flex-col justify-between gap-24 mt-16 md:flex-row"},Re={class:"flex flex-col gap-2"},ze={class:"font-semibold"},We={key:0,class:"flex flex-col gap-2"},Ke={class:"font-semibold"},Ue={class:"flex flex-col gap-2"},Ye={class:"font-semibold"},Fe=D({__name:"IncidentDetailsSummary",props:{date:{},ip:{},inputChannel:{}},setup(e){return(t,n)=>(s(),l("section",Ve,[n[3]||(n[3]=o("h2",{class:"font-semibold"},"Incident info",-1)),o("ul",Ge,[o("li",Re,[n[0]||(n[0]=o("span",{class:"text-xs text-red-100"},"Date",-1)),o("span",ze,m(t.date)+"Â ",1)]),t.ip?(s(),l("li",We,[n[1]||(n[1]=o("span",{class:"text-xs text-red-100"},"IP",-1)),o("span",Ke,m(t.ip),1)])):v("",!0),o("li",Ue,[n[2]||(n[2]=o("span",{class:"text-xs text-red-100"},"Channel",-1)),o("span",Ye,m(t.inputChannel),1)])])]))}});function He(e,t){return X.hasOwnProperty(t)?X[t]:e}function Je(e){return e.replace(/_/g," ").replace(/^(.)/,function(n,u){return u.toUpperCase()})}function U(e){try{return Object.entries(e).reduce((t,[n,u])=>{const r=q.hasOwnProperty(n)?q[n]:Je(n);return typeof u=="object"&&u!==null?t[r]=U(u):t[r]=u,t},{})}catch(t){return console.error(`Error in formatting labels: ${t}`),e}}function qe(e){const t=Object.values(N).find(n=>n===e);return t?K[t].label:e}function B(e){return typeof e=="object"&&e!==null?Array.isArray(e)?e.length>0:Object.values(e).some(t=>t!=null&&(typeof t!="object"||Object.keys(t).length>0)):e!=null}function se(e){return e===N.CREDIT_CARD_V2}function Xe(e){return e===N.AWS_KEYS}function Qe(e){return e===N.PWA}function Ze(e,t){return Qe(e)?typeof t=="string"?t:t==null?void 0:t.coords:t}function Ae(e){return se(e.token_type)?null:e.geo_info.bogon?{ip:e.geo_info.ip,bogon:e.geo_info.bogon}:{...e.geo_info}}function Z(e){var t;try{return{basic_info:{token_type:qe(e.token_type),input_channel:He(e.input_channel,e.token_type),src_data:e.src_data,useragent:e.useragent||null,last4:e.last4||null,amount:e.amount||null,merchant:e.merchant||null,mail:e.mail||null,referer:e.referer||null,location:e.location&&Ze(e.token_type,e.location)||null},time_of_hit:H(e.time_of_hit),src_ip:e.src_ip,geo_info:Ae(e),is_tor_relay:se(e.token_type)?null:e.is_tor_relay,additional_info:{...e.additional_info,aws_key_log_data:Xe(e.token_type)&&e.additional_info.aws_key_log_data?{last_used:e.additional_info.aws_key_log_data.last_used?ue(e.additional_info.aws_key_log_data.last_used):null,service_used:e.additional_info.aws_key_log_data.service_used,eventName:((t=e.additional_info.aws_key_log_data)==null?void 0:t.eventName)??null}:null}}}catch(n){return console.error(`Error in building the Incident Details object: ${n}`),e}}const et={class:"sticky top-[0px] bg-white h-[4rem] sm:h-40 flex justify-end"},tt={class:"px-16"},nt={class:"grid md:grid-cols-[auto_1fr] gap-32 mt-32 pl-8"},st={key:0,class:"text-grey-500"},ot={key:1,class:"flex flex-col gap-16 pb-16 [&:not(:last-child)]:border-b md:ml-32 border-grey-100"},lt={key:0,class:"break-words"},at={class:"text-grey-500"},it=D({__name:"IncidentDetails",props:{hitAlert:{},showingMap:{type:Boolean,default:!0}},emits:["close"],setup(e,{emit:t}){const n=e,u=t,r=x(null),f=x({});return F(()=>{r.value=Z(n.hitAlert),f.value=U(r.value)}),ee(()=>n.hitAlert,()=>{r.value=Z(n.hitAlert),f.value=U(r.value)}),(c,a)=>{var S;const y=E("font-awesome-icon");return s(),l("div",{class:R(["pb-32 bg-white rounded-3xl",{"sm:m-8":n.showingMap,"border shadow-solid-shadow-grey border-grey-100":!n.showingMap}])},[o("div",et,[n.showingMap?(s(),l("button",{key:0,type:"button",class:"px-16",onClick:a[0]||(a[0]=$=>u("close"))},[_(y,{icon:"xmark",class:"w-24 h-24 sm:w-16 sm:h-16 text-grey-400 hover:text-grey-200"})])):v("",!0)]),o("div",tt,[r.value?(s(),b(Fe,{key:0,date:(S=r.value)==null?void 0:S.time_of_hit,ip:r.value.src_ip,"input-channel":r.value.basic_info.input_channel},null,8,["date","ip","input-channel"])):v("",!0),o("section",nt,[(s(!0),l(g,null,M(f.value,($,I)=>(s(),l(g,{key:I},[w(B)(I)&&w(B)($)?(s(),l("h3",st,m(I)+": ",1)):v("",!0),w(B)($)?(s(),l("ul",ot,[w(j)($)?(s(!0),l(g,{key:1},M($,(i,d)=>(s(),l(g,{key:d},[w(B)(i)?(s(),l("ul",lt,[w(j)(i)?(s(),l(g,{key:1},[o("ul",null,[o("h3",at,m(d)+":",1),(s(!0),l(g,null,M(i,(p,h)=>(s(),l(g,{key:h},[!w(j)(p)&&w(B)(p)?(s(),b(V,{key:0,label:h,value:p,class:"py-8 ml-24"},null,8,["label","value"])):(s(!0),l(g,{key:1},M(p,(C,k)=>(s(),l(g,{key:k},[!w(j)(C)&&w(B)(C)?(s(),b(V,{key:0,label:h,value:C,class:"py-8 ml-24"},null,8,["label","value"])):v("",!0)],64))),128))],64))),128))]),a[1]||(a[1]=o("div",{class:"border-b border-grey-100"},null,-1))],64)):(s(),b(V,{key:0,label:d,value:i},null,8,["label","value"]))])):v("",!0)],64))),128)):(s(),b(V,{key:0,value:$},null,8,["value"]))])):v("",!0)],64))),128))])])],2)}}}),rt=Y(it,[["__scopeId","data-v-a381c6eb"]]),ut={class:"flex flex-row flex-wrap items-center justify-between px-16 py-8 mb-8 bg-white border rounded-2xl shadow-solid-shadow-grey border-grey-100"},ct={class:"flex flex-row"},dt=D({__name:"AlertsListDownload",setup(e){const t=ne(),n=x(!1),u=x(!1);function r(f){f===z.CSV?n.value=!0:u.value=!0;const c={fmt:f,auth:t.params.auth,token:t.params.token};ce(c).then(a=>{window.location.href=a.request.responseURL}).catch(a=>{console.log(a,"err")}).finally(()=>{n.value=!1,u.value=!1,console.log("You downloaded the file, yay!")})}return(f,c)=>{const a=de;return s(),l("li",ut,[c[4]||(c[4]=o("p",{class:"text-sm text-grey-500"},"Download list",-1)),o("div",ct,[_(a,{variant:"text",icon:"file",loading:n.value,onClick:c[0]||(c[0]=y=>r(w(z).CSV))},{default:L(()=>c[2]||(c[2]=[G("CSV")])),_:1},8,["loading"]),_(a,{variant:"text",icon:"file-excel",loading:u.value,onClick:c[1]||(c[1]=y=>r(w(z).JSON))},{default:L(()=>c[3]||(c[3]=[G("JSON")])),_:1},8,["loading"])])])}}}),pt={class:"flex flex-col gap-16 mx-16 mt-[60px]"},ft={class:"flex flex-col gap-16 mt-[60px]"},_t={class:"flex flex-col h-full gap-16 pb-16"},mt={key:0,class:"flex flex-col items-center justify-center flex-grow px-16 py-16 align-middle"},yt=["src"],gt=D({__name:"HistoryToken",emits:["update-token-title"],setup(e,{emit:t}){const n=t,u=ne(),r=pe(),f=x(!1),c=x(null),a=x(),y=x(),S=x();F(async()=>{await $()});async function $(){f.value=!0;const d={auth:u.params.auth,token:u.params.token};try{const h=await(await fe(d)).data;a.value=h.history.hits.sort((C,k)=>k.time_of_hit-C.time_of_hit),S.value=h.history.token_type,n("update-token-title",h.history.token_type,u.params.token),!i()&&a.value.length>0&&I(a.value[0])}catch(p){console.log(p,"err!"),c.value=p.toString(),r.push({name:"error"})}finally{f.value=!1}}async function I(d){await _e(()=>{y.value=d;const p=document.getElementById("incident_detail");p?p.scrollTo({top:0,behavior:"smooth"}):window.scrollTo({top:0,behavior:"smooth"})})}function i(){return![N.CREDIT_CARD_V2].includes(S.value)}return(d,p)=>{const h=te,C=ye;return s(),l(g,null,[f.value?(s(),l(g,{key:0},[o("div",pt,[_(h,{type:"header",class:"w-[200px]"}),_(h,{class:"h-[10vh]"}),_(h,{class:"h-[10vh]"}),_(h,{class:"h-[10vh]"})]),o("div",ft,[_(h,{class:"h-[50svh] w-full"}),_(h,{class:"h-[20svh] w-full"})])],64)):v("",!0),c.value?(s(),b(C,{key:1,variant:"danger",message:"Oh no! Something went wrong. Please refresh the page or try again later."})):v("",!0),a.value?(s(),l(g,{key:2},[o("div",{id:"alerts-card-list",class:R(["flex-col md:p-16 md:bg-grey-50 md:rounded-3xl md:overflow-scroll md:max-h-[70svh]",{"hidden md:block":y.value}])},[o("ul",_t,[p[2]||(p[2]=o("h2",{class:"font-semibold leading-5 text-grey-800"},"Alerts list",-1)),a.value.length===0?(s(),l("li",mt,[p[1]||(p[1]=o("p",{class:"text-xl text-center text-grey-400"}," There are no alerts for this Canarytoken. ",-1)),o("img",{src:w(W)("token_icons/default.png"),alt:"No alerts",class:"grayscale opacity-50 w-[50%] not-sr-only group-hover:opacity-100 sm:block mt-16"},null,8,yt)])):(s(),b(dt,{key:1})),(s(!0),l(g,null,M(a.value,(k,P)=>(s(),b(De,{key:P,"last-key":P===a.value.length-1,"incident-id":k.time_of_hit,"incident-preview-info":{Date:w(H)(k.time_of_hit),IP:k.src_ip,Channel:k.input_channel},onClick:T=>I(k)},null,8,["last-key","incident-id","incident-preview-info","onClick"]))),128)),_(Q,{class:"flex sm:hidden"})])],2),o("div",null,[o("div",{class:R(["@md:relative md:h-[45svh] h-[30svh]",a.value.length===0?"hidden sm:grid":"grid"])},[_(me,{name:"slide-fade"},{default:L(()=>[y.value?(s(),b(rt,{key:0,id:"incident_detail",showingMap:i(),"hit-alert":y.value,class:"absolute top-[120px] left-[0] md:top-[0px] md:relative grid-areas z-10 md:overflow-scroll w-full sm:w-auto",onClose:p[0]||(p[0]=k=>y.value=null)},null,8,["showingMap","hit-alert"])):v("",!0)]),_:1}),i()?(s(),b(Oe,{key:0,"hits-list":a.value},null,8,["hits-list"])):v("",!0)],2),_(Q,{class:"hidden sm:flex"})])],64)):v("",!0)],64)}}}),ht={key:0,class:"flex flex-col items-center gap-8 mt-16"},vt={class:"mb-24 text-xl text-center text-grey-500"},xt={class:"text-grey-300"},wt={class:"font-semibold"},Tt=D({__name:"HistoryView",setup(e){const t=x(""),n=x(""),u=x("");function r(f,c){t.value=K[f].label,u.value=K[f].icon,n.value=c}return(f,c)=>(s(),l(g,null,[t.value&&n.value&&u.value?(s(),l("div",ht,[_(ge,{title:t.value,"logo-img-url":u.value,class:"h-[4rem] w-[4rem]","has-shadow":!1},null,8,["title","logo-img-url"]),o("div",vt,[o("h2",null,[o("span",xt,m(t.value)+" Canarytoken ID: ",1),o("span",wt,m(n.value),1)])])])):v("",!0),_(we,null,{default:L(()=>[_(gt,{onUpdateTokenTitle:c[0]||(c[0]=(a,y)=>r(a,y))})]),_:1})],64))}});export{Tt as default};
