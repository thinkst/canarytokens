import{b as v}from"./awsInfra-DuYOQ03w.js";import{_ as A}from"./StepState.vue_vue_type_script_setup_true_lang-DAe_izlq.js";import{d as k,r as l,o as S,e as D,h as L,k as p,M as C,i as T}from"./index-BDTIPFyt.js";const x={class:"w-full flex text-center flex-col items-center"},E={class:"infra-token__title-wrapper"},O=k({__name:"InventoryAwsAccount",props:{initialStepData:{}},emits:["updateStep","storeCurrentStepData"],setup(d,{emit:f}){const u=f,m=d,e=l(!0),a=l(!1),o=l(!1),r=l(""),{token:c,auth_token:i}=m.initialStepData;S(async()=>{await _()});async function _(){e.value=!0,a.value=!1,o.value=!1;try{const n=await v({canarytoken:c,auth_token:i});n.status!==200&&(e.value=!1,a.value=!0,r.value=n.data.error_message);const y=n.data.handle,I=Date.now(),h=5*60*1e3,s=setInterval(async()=>{try{const t=await v({handle:y});if(t.status!==200){e.value=!1,a.value=!0,r.value=t.data.error,clearInterval(s);return}if(t.data.error){e.value=!1,a.value=!0,r.value=t.data.error,clearInterval(s);return}if(Date.now()-I>=h){e.value=!1,a.value=!0,r.value="The operation took too long. Try again.",clearInterval(s);return}if(t.data.proposed_plan){e.value=!1,o.value=!0;const w=t.data.proposed_plan;u("storeCurrentStepData",{token:c,auth_token:i,proposed_plan:w}),clearInterval(s),u("updateStep");return}}catch(t){a.value=!0,r.value=t.message||"An error occurred while inventoring the account. Try again",clearInterval(s);return}finally{e.value=!1;return}},5e3)}catch(n){a.value=!0,r.value=n.message,o.value=!1}}return(g,n)=>(D(),L("section",x,[p("div",E,[p("h2",null,C(e.value||a.value?"Inventoring...":"Inventory done!"),1)]),T(A,{"is-loading":e.value,"is-error":a.value,"loading-message":"We are inventoring your account, hold on","error-message":r.value,"is-success":o.value,"success-message":"All set!"},null,8,["is-loading","is-error","error-message","is-success"])]))}});export{O as default};
