import{d as C,r as i,o as E,e as d,h as I,k as g,M as w,i as R,f as D,w as T,v as x,j as L,D as A}from"./index-BDTIPFyt.js";import{a as m}from"./awsInfra-DuYOQ03w.js";import{_ as B}from"./StepState.vue_vue_type_script_setup_true_lang-DAe_izlq.js";const N={class:"w-full flex text-center flex-col items-center"},V={class:"infra-token__title-wrapper"},j=C({__name:"CheckAwsRole",props:{initialStepData:{}},emits:["updateStep","storeCurrentStepData","isSettingError"],setup(p,{emit:h}){const t=h,_=p,a=i(!0),e=i(!1),l=i(!1),s=i(""),{token:c,auth_token:v}=_.initialStepData;E(async()=>{t("isSettingError",!1),await f()});async function f(){a.value=!0,e.value=!1,l.value=!1;try{const r=await m({canarytoken:c,auth_token:v});r.status!==200&&(a.value=!1,e.value=!0,s.value=r.data.message,t("isSettingError",!0));const u=r.data.handle,S=Date.now(),y=5*60*1e3,o=setInterval(async()=>{try{const n=await m({handle:u});if(n.status!==200){a.value=!1,e.value=!0,s.value=n.data.error,t("isSettingError",!0),clearInterval(o);return}if(n.data.error){a.value=!1,e.value=!0,s.value=n.data.error,t("isSettingError",!0),clearInterval(o);return}if(Date.now()-S>=y){e.value=!0,s.value="The operation took too long. Try again.",t("isSettingError",!0),clearInterval(o);return}if(n.data.session_credentials_retrieved){a.value=!1,l.value=!0,t("storeCurrentStepData",{token:c,auth_token:v}),clearInterval(o),t("updateStep");return}}catch(n){e.value=!0,s.value=n.message||"An error occurred while checking the Role. Try again",t("isSettingError",!0),clearInterval(o);return}finally{a.value=!1}},5e3)}catch(r){e.value=!0,s.value=r.message,l.value=!1,t("isSettingError",!0)}}return(k,r)=>{const u=A;return d(),I("section",N,[g("div",V,[g("h2",null,w(a.value||e.value?"Checking Role...":"Role Checked!"),1)]),R(B,{"is-loading":a.value,"is-error":e.value,"loading-message":"We are checking the role, hold on","error-message":s.value,"is-success":l.value,"success-message":"All set!"},null,8,["is-loading","is-error","error-message","is-success"]),e.value?(d(),D(u,{key:0,class:"mt-40",variant:"secondary",onClick:f},{default:T(()=>r[0]||(r[0]=[x(" Try again ")])),_:1})):L("",!0)])}}});export{j as default};
