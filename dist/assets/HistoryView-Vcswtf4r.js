import{y as q,a as o,c as a,A as se,d as M,z as E,f as n,i as f,O as ae,I as h,P as S,E as y,e as v,h as R,Q as A,w as le,r as x,C as ie,o as F,D as ee,b as T,j as D,R as j,g as K,K as te,u as k,n as z,V as J,W as X,X as re,T as N,t as U,Y as ue,Z as B,$ as V,B as oe,a0 as W,a1 as ce,q as de,k as pe,a2 as _e,a3 as fe,a4 as me,p as ye,l as ge}from"./index-Don7mZUa.js";import{B as Q}from"./BannerDeviceCanarytools-rSUiuE91.js";const he={},ve={class:"grid two-col-grid"};function xe(e,s){return o(),a("div",ve,[se(e.$slots,"default")])}const we=q(he,[["render",xe]]),ke={class:"w-full @container"},be={class:"flex flex-row items-center flex-1 gap-16"},Te={class:"text-left"},$e={key:0,class:"capitalize text-grey-400"},Ce={key:1,class:"mr-8 font-semibold"},Ie={class:"flex flex-row items-center justify-end gap-8 mt-8 font-semibold text-red sm:hidden"},Le=M({__name:"CardIncident",props:{lastKey:{type:Boolean},incidentPreviewInfo:{},incidentId:{}},emits:["click"],setup(e,{emit:s}){const t=s;function c(){t("click")}return(i,_)=>{const r=E("font-awesome-icon");return o(),a("li",ke,[n("button",A(i.$attrs,{class:["relative w-full px-16 py-8 transition duration-100 bg-white border text-grey-700 grouped group rounded-2xl shadow-solid-shadow-grey border-grey-200 error-card",{"mb-8":i.lastKey}],onClick:le(c,["stop"])}),[n("span",be,[f(ae,{class:"hidden @xs:block min-w-[30px] group-hover:fill-red group-focus:fill-red group-active:fill-red fill-grey-700 group-hover:scale-95 transition duration-200","aria-hidden":"true"}),n("span",Te,[(o(!0),a(h,null,S(i.incidentPreviewInfo,(l,g)=>(o(),a("span",{key:g,class:"block"},[l!==null?(o(),a("span",$e,y(g)+": ",1)):v("",!0),l!==null?(o(),a("span",Ce,y(l),1)):v("",!0)]))),128))])]),n("span",Ie,[_[0]||(_[0]=R("Check Incident ")),f(r,{icon:"arrow-right",class:"text-red","aria-hidden":"true"})])],16)])}}}),De=q(Le,[["__scopeId","data-v-4d0f5b0e"]]),Me={key:0},Se={key:1,class:"placeholder-map"},Be={class:"font-medium"},Ee={class:"pb-8"},Ne={class:"font-medium"},Pe={class:"pt-8"},Oe=M({__name:"CustomMap",props:{hitsList:{}},setup(e){const s=e,t=x(!0),c=x(),i=x(),_=x({lat:-33.9221,lng:18.4231});function r(u){const d=u.split(",");return{lat:parseFloat(d[0]),lng:parseFloat(d[1])}}const l=ie(()=>s.hitsList.filter(function(u){return!!u.geo_info}).map(u=>{var d,p,m,b,w;return{id:u.time_of_hit,ip:(d=u.geo_info)==null?void 0:d.ip,hostname:(p=u.geo_info)==null?void 0:p.hostname,city:(m=u.geo_info)==null?void 0:m.city,country:(b=u.geo_info)==null?void 0:b.country,date:j(u.time_of_hit),position:(w=u.geo_info)!=null&&w.loc?r(u.geo_info.loc):void 0}}));F(()=>{if(l.value.length!==0){if(l.value.length>1)return I();l.value.length===1&&l.value[0].position!=null&&(_.value=l.value[0].position)}});function g(u){c.value=u}async function I(){const u=await i.value.$mapPromise,d=new window.google.maps.LatLngBounds;l.value.forEach(p=>{d.extend(p.position)}),u.fitBounds(d)}ee(i,()=>{i.value&&i.value.$mapPromise.then(()=>{t.value=!1})});const C=({count:u,position:d})=>new window.google.maps.Marker({label:{text:`${u}`,color:"white",fontWeight:"600"},icon:{url:K("icons/map-cluster-pin.png"),scaledSize:{width:40,height:40}},position:d,zIndex:1e3+u}),L={zoomControl:!0,mapTypeControl:!1,streetViewControl:!1,rotateControl:!0,fullscreenControl:!1,styles:[{featureType:"administrative.country",elementType:"geometry.stroke",stylers:[{lightness:"52"}]},{featureType:"administrative.country",elementType:"labels.text.fill",stylers:[{lightness:"60"}]},{featureType:"administrative.province",elementType:"labels.text.fill",stylers:[{lightness:"24"}]},{featureType:"administrative.locality",elementType:"labels.text.fill",stylers:[{lightness:"29"}]},{featureType:"administrative.locality",elementType:"labels.icon",stylers:[{lightness:"47"},{hue:"#ff0000"}]},{featureType:"landscape",elementType:"all",stylers:[{saturation:13.400000000000006},{lightness:57.599999999999994},{gamma:1}]},{featureType:"poi",elementType:"all",stylers:[{saturation:-1.0989010989011234},{lightness:11.200000000000017},{gamma:1}]},{featureType:"road.highway",elementType:"all",stylers:[{saturation:-61.8},{lightness:45.599999999999994},{gamma:1}]},{featureType:"road.arterial",elementType:"all",stylers:[{saturation:-100},{lightness:51.19999999999999},{gamma:1}]},{featureType:"road.local",elementType:"all",stylers:[{saturation:-100},{lightness:52},{gamma:1}]},{featureType:"water",elementType:"all",stylers:[{saturation:-13.200000000000003},{lightness:2.4000000000000057},{gamma:1}]},{featureType:"water",elementType:"geometry.fill",stylers:[{lightness:"38"},{saturation:"-55"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{lightness:"65"},{saturation:"52"}]}]};return(u,d)=>{const p=te,m=E("GMapInfoWindow"),b=E("GMapMarker"),w=E("GMapCluster"),P=E("GMapMap");return o(),a(h,null,[t.value?(o(),a("div",Me,[f(p,{type:"rectangle",class:"md:h-[40svh] h-[30svh]"})])):v("",!0),!t.value&&u.hitsList.length===0?(o(),a("div",Se)):(o(),T(P,A({key:2},u.$attrs,{ref_key:"mapRef",ref:i,zoom:6,center:_.value,"map-type-id":"terrain",class:"grid-areas rounded-2xl",options:L}),{default:D(()=>[f(w,{renderer:{render:C},"zoom-on-click":!0},{default:D(()=>[(o(!0),a(h,null,S(l.value,($,ne)=>(o(),T(b,{key:ne,position:$.position,clickable:!0,icon:{url:k(K)("icons/map-pin.png"),scaledSize:{width:60,height:60},labelOrigin:{x:16,y:-60}},onClick:O=>g($.id)},{default:D(()=>[f(m,{closeclick:!0,opened:c.value===$.id,class:"px-8 py-8",onCloseclick:d[0]||(d[0]=O=>g(null))},{default:D(()=>{var O,H;return[n("ul",null,[n("li",null,[d[1]||(d[1]=R(" From IP: ")),n("span",Be,y($.ip),1)]),n("li",Ee,y($.hostname),1),n("li",Ne,y($.date),1),n("li",Pe,y($.city)+", "+y($.country),1),n("li",null," Lat: "+y(((O=$.position)==null?void 0:O.lat)||"")+", Lng: "+y(((H=$.position)==null?void 0:H.lng)||""),1)])]}),_:2},1032,["opened"])]),_:2},1032,["position","icon","onClick"]))),128))]),_:1},8,["renderer"])]),_:1},16,["center"]))],64)}}}),Ve={class:"block text-xs uppercase text-grey-500"},G=M({__name:"IncidentDetailsListItem",props:{label:{},value:{type:[String,Boolean,Number]}},setup(e){function s(t){if(typeof t=="boolean")return t?"text-green":"text-red"}return(t,c)=>(o(),a("li",null,[n("span",Ve,y(t.label),1),n("span",{class:z(s(t.value))},y(t.value),3)]))}}),Ge={class:"p-16 text-white rounded-md bg-red"},Re={class:"flex flex-col justify-between gap-24 mt-16 md:flex-row"},je={class:"flex flex-col gap-2"},ze={class:"font-semibold"},We={key:0,class:"flex flex-col gap-2"},Ke={class:"font-semibold"},Ue={class:"flex flex-col gap-2"},Ye={class:"font-semibold"},qe=M({__name:"IncidentDetailsSummary",props:{date:{},ip:{},inputChannel:{}},setup(e){return(s,t)=>(o(),a("section",Ge,[t[3]||(t[3]=n("h2",{class:"font-semibold"},"Incident info",-1)),n("ul",Re,[n("li",je,[t[0]||(t[0]=n("span",{class:"text-xs text-red-100"},"Date",-1)),n("span",ze,y(s.date)+"Â ",1)]),s.ip?(o(),a("li",We,[t[1]||(t[1]=n("span",{class:"text-xs text-red-100"},"IP",-1)),n("span",Ke,y(s.ip),1)])):v("",!0),n("li",Ue,[t[2]||(t[2]=n("span",{class:"text-xs text-red-100"},"Channel",-1)),n("span",Ye,y(s.inputChannel),1)])])]))}});function Fe(e,s){return J.hasOwnProperty(s)?J[s]:e}function Y(e){try{return Object.entries(e).reduce((s,[t,c])=>{const i=X.hasOwnProperty(t)?X[t]:re(t);return typeof c=="object"&&c!==null?s[i]=Y(c):s[i]=c,s},{})}catch(s){return console.error(`Error in formatting labels: ${s}`),e}}function He(e){const s=Object.values(N).find(t=>t===e);return s?U[s].label:e}function Je(e){return e.geo_info==null?null:e.geo_info.bogon?{ip:e.geo_info.ip,bogon:e.geo_info.bogon}:{...e.geo_info}}function Z(e,s){var i;const t={token_type:He(e.token_type),input_channel:Fe(e.input_channel,e.token_type),src_data:e.src_data,useragent:e.useragent||null,last4:e.last4||null,amount:e.amount||null,merchant:e.merchant||null,mail:e.mail||null,referer:e.referer||e.referrer||null,request_args:(e==null?void 0:e.request_args)||null},c={time_of_hit:j(e.time_of_hit),src_ip:e.src_ip,geo_info:Je(e)};switch(s){case N.AWS_KEYS:return{basic_info:{...t,location:e.location?e.location:null},...c,is_tor_relay:e.is_tor_relay,additional_info:{...e.additional_info,aws_key_log_data:e.additional_info.aws_key_log_data?{last_used:e.additional_info.aws_key_log_data.last_used?ue(e.additional_info.aws_key_log_data.last_used):null,service_used:e.additional_info.aws_key_log_data.service_used,eventName:((i=e.additional_info.aws_key_log_data)==null?void 0:i.eventName)??null}:null}};case N.CREDIT_CARD_V2:return{basic_info:{...t,location:e.location?e.location:null},time_of_hit:j(e.time_of_hit),is_tor_relay:null,additional_info:{...e.additional_info,aws_key_log_data:null}};case N.PWA:let _=function(r){return typeof r=="string"?r:r.coords!==null?r.coords:r};return{basic_info:{...t,location:e.location?_(e.location):null},...c,is_tor_relay:e.is_tor_relay,additional_info:{...e.additional_info,aws_key_log_data:null}};default:return{basic_info:{...t,location:e.location?e.location:null},...c,is_tor_relay:e.is_tor_relay,additional_info:{...e.additional_info,aws_key_log_data:null}}}}const Xe={class:"sticky top-[0px] bg-white h-[4rem] sm:h-40 flex justify-end"},Qe={class:"px-16"},Ze={class:"grid md:grid-cols-[auto_1fr] gap-32 mt-32 pl-8"},Ae={key:0,class:"text-grey-500"},et={key:1,class:"flex flex-col gap-16 pb-16 [&:not(:last-child)]:border-b md:ml-32 border-grey-100"},tt={key:0,class:"break-words"},ot={key:1},nt={class:"text-grey-500"},st=M({__name:"IncidentDetails",props:{hitAlert:{},showingMap:{type:Boolean,default:!0},tokenType:{}},emits:["close"],setup(e,{emit:s}){const t=e,c=s,i=x(null),_=x({});return F(()=>{i.value=Z(t.hitAlert,t.tokenType),_.value=Y(i.value)}),ee(()=>t.hitAlert,()=>{i.value=Z(t.hitAlert,t.tokenType),_.value=Y(i.value)}),(r,l)=>{var I;const g=E("font-awesome-icon");return o(),a("div",{class:z(["pb-32 bg-white rounded-3xl",{"sm:m-8":t.showingMap,"border shadow-solid-shadow-grey border-grey-100":!t.showingMap}])},[n("div",Xe,[t.showingMap?(o(),a("button",{key:0,type:"button",class:"px-16",onClick:l[0]||(l[0]=C=>c("close"))},[f(g,{icon:"xmark",class:"w-24 h-24 sm:w-16 sm:h-16 text-grey-400 hover:text-grey-200"})])):v("",!0)]),n("div",Qe,[i.value?(o(),T(qe,{key:0,date:(I=i.value)==null?void 0:I.time_of_hit,ip:i.value.src_ip,"input-channel":i.value.basic_info.input_channel},null,8,["date","ip","input-channel"])):v("",!0),n("section",Ze,[(o(!0),a(h,null,S(_.value,(C,L)=>(o(),a(h,{key:L},[k(B)(L)&&k(B)(C)?(o(),a("h3",Ae,y(L)+": ",1)):v("",!0),k(B)(C)?(o(),a("ul",et,[k(V)(C)?(o(!0),a(h,{key:1},S(C,(u,d)=>(o(),a(h,{key:d},[k(B)(u)?(o(),a("ul",tt,[k(V)(u)?(o(),a("ul",ot,[n("h3",nt,y(d)+":",1),(o(!0),a(h,null,S(u,(p,m)=>(o(),a(h,{key:m},[!k(V)(p)&&k(B)(p)?(o(),T(G,{key:0,label:m,value:p,class:"py-8 ml-24"},null,8,["label","value"])):(o(!0),a(h,{key:1},S(p,(b,w)=>(o(),a(h,{key:w},[!k(V)(b)&&k(B)(b)?(o(),T(G,{key:0,label:m,value:b,class:"py-8 ml-24"},null,8,["label","value"])):v("",!0)],64))),128))],64))),128))])):(o(),T(G,{key:0,label:d,value:u},null,8,["label","value"]))])):v("",!0)],64))),128)):(o(),T(G,{key:0,value:C},null,8,["value"]))])):v("",!0)],64))),128))])])],2)}}}),at=q(st,[["__scopeId","data-v-2413b925"]]),lt={class:"flex flex-row flex-wrap items-center justify-between px-16 py-8 mb-8 bg-white border rounded-2xl shadow-solid-shadow-grey border-grey-100"},it={class:"flex flex-row"},rt=M({__name:"AlertsListDownload",setup(e){const s=oe(),t=x(!1),c=x(!1);function i(_){_===W.CSV?t.value=!0:c.value=!0;const r={fmt:_,auth:s.params.auth,token:s.params.token};ce(r).then(l=>{window.location.href=l.request.responseURL}).catch(l=>{console.log(l,"err")}).finally(()=>{t.value=!1,c.value=!1,console.log("You downloaded the file, yay!")})}return(_,r)=>{const l=de;return o(),a("li",lt,[r[4]||(r[4]=n("p",{class:"text-sm text-grey-500"},"Download list",-1)),n("div",it,[f(l,{variant:"text",icon:"file",loading:t.value,onClick:r[0]||(r[0]=g=>i(k(W).CSV))},{default:D(()=>r[2]||(r[2]=[R("CSV")])),_:1},8,["loading"]),f(l,{variant:"text",icon:"file-excel",loading:c.value,onClick:r[1]||(r[1]=g=>i(k(W).JSON))},{default:D(()=>r[3]||(r[3]=[R("JSON")])),_:1},8,["loading"])])])}}}),ut={class:"flex flex-col gap-16 mx-16 mt-[60px]"},ct={class:"flex flex-col gap-16 mt-[60px]"},dt={class:"flex flex-col h-full gap-16 pb-16"},pt={key:0,class:"flex flex-col items-center justify-center flex-grow px-16 py-16 align-middle"},_t=["src"],ft=M({__name:"HistoryToken",emits:["update-token-title"],setup(e,{emit:s}){const t=s,c=oe(),i=pe(),_=x(!1),r=x(null),l=x(),g=x(),I=x();F(async()=>{await C()});async function C(){_.value=!0;const d={auth:c.params.auth,token:c.params.token};try{const m=await(await _e(d)).data;l.value=m.history.hits.sort((b,w)=>w.time_of_hit-b.time_of_hit),I.value=m.history.token_type,t("update-token-title",m.history.token_type,c.params.token),!u()&&l.value.length>0&&L(l.value[0])}catch(p){console.log(p,"err!"),r.value=p.toString(),i.push({name:"error"})}finally{_.value=!1}}async function L(d){await fe(()=>{g.value=d;const p=document.getElementById("incident_detail");p?p.scrollTo({top:0,behavior:"smooth"}):window.scrollTo({top:0,behavior:"smooth"})})}function u(){return![N.CREDIT_CARD_V2].includes(I.value)}return(d,p)=>{const m=te,b=ye;return o(),a(h,null,[_.value?(o(),a(h,{key:0},[n("div",ut,[f(m,{type:"header",class:"w-[200px]"}),f(m,{class:"h-[10vh]"}),f(m,{class:"h-[10vh]"}),f(m,{class:"h-[10vh]"})]),n("div",ct,[f(m,{class:"h-[50svh] w-full"}),f(m,{class:"h-[20svh] w-full"})])],64)):v("",!0),r.value?(o(),T(b,{key:1,variant:"danger",message:"Oh no! Something went wrong. Please refresh the page or try again later."})):v("",!0),l.value?(o(),a(h,{key:2},[n("div",{id:"alerts-card-list",class:z(["flex-col md:p-16 md:bg-grey-50 md:rounded-3xl md:overflow-scroll md:max-h-[70svh]",{"hidden md:block":g.value}])},[n("ul",dt,[p[2]||(p[2]=n("h2",{class:"font-semibold leading-5 text-grey-800"},"Alerts list",-1)),l.value.length===0?(o(),a("li",pt,[p[1]||(p[1]=n("p",{class:"text-xl text-center text-grey-400"}," There are no alerts for this Canarytoken. ",-1)),n("img",{src:k(K)("token_icons/default.png"),alt:"No alerts",class:"grayscale opacity-50 w-[50%] not-sr-only group-hover:opacity-100 sm:block mt-16"},null,8,_t)])):(o(),T(rt,{key:1})),(o(!0),a(h,null,S(l.value,(w,P)=>(o(),T(De,{key:P,"last-key":P===l.value.length-1,"incident-id":w.time_of_hit,"incident-preview-info":{Date:k(j)(w.time_of_hit),IP:w.src_ip,Channel:w.input_channel},onClick:$=>L(w)},null,8,["last-key","incident-id","incident-preview-info","onClick"]))),128)),f(Q,{class:"flex sm:hidden"})])],2),n("div",null,[n("div",{class:z(["@md:relative md:h-[45svh] h-[30svh]",l.value.length===0?"hidden sm:grid":"grid"])},[f(me,{name:"slide-fade"},{default:D(()=>[g.value?(o(),T(at,{key:0,id:"incident_detail","showing-map":u(),"hit-alert":g.value,class:"absolute top-[120px] left-[0] md:top-[0px] md:relative grid-areas z-10 md:overflow-scroll w-full sm:w-auto","token-type":I.value,onClose:p[0]||(p[0]=w=>g.value=null)},null,8,["showing-map","hit-alert","token-type"])):v("",!0)]),_:1}),u()?(o(),T(Oe,{key:0,"hits-list":l.value},null,8,["hits-list"])):v("",!0)],2),f(Q,{class:"hidden sm:flex"})])],64)):v("",!0)],64)}}}),mt={key:0,class:"flex flex-col items-center gap-8 mt-16"},yt={class:"mb-24 text-xl text-center text-grey-500"},gt={class:"text-grey-300"},ht={class:"font-semibold"},wt=M({__name:"HistoryView",setup(e){const s=x(""),t=x(""),c=x("");function i(_,r){s.value=U[_].label,c.value=U[_].icon,t.value=r}return(_,r)=>(o(),a(h,null,[s.value&&t.value&&c.value?(o(),a("div",mt,[f(ge,{title:s.value,"logo-img-url":c.value,class:"h-[4rem] w-[4rem]","has-shadow":!1},null,8,["title","logo-img-url"]),n("div",yt,[n("h2",null,[n("span",gt,y(s.value)+" Canarytoken ID: ",1),n("span",ht,y(t.value),1)])])])):v("",!0),f(we,null,{default:D(()=>[f(ft,{onUpdateTokenTitle:r[0]||(r[0]=(l,g)=>i(l,g))})]),_:1})],64))}});export{wt as default};
