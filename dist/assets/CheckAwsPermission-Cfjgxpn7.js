import{d as E,r as l,o as R,au as W,av as q,e as o,h as i,k as e,M as u,i as c,w as m,l as d,m as N,v as n,j as r,aw as $,f as g,D as L,H as M}from"./index-CVx3_slE.js";import{_ as P}from"./BaseFormTextField.vue_vue_type_style_index_0_lang-C3M8lqtY.js";import{_ as T}from"./BaseCodeSnippet.vue_vue_type_script_setup_true_lang-5L0UGysc.js";import{_ as V}from"./BaseCard-FWdKLBGT.js";import{_ as j}from"./StepState.vue_vue_type_script_setup_true_lang-VwHdhTox.js";import"./BaseLabel.vue_vue_type_script_setup_true_lang-BxRQFccT.js";import"./BaseCopyButton-CBuQ4QqG.js";const F={class:"flex text-center flex-col"},O={class:"infra-token__title-wrapper flex flex-col items-center"},H={key:0},U=["src"],Z={class:"text-md text-grey-400 leading-4"},z={class:"text-grey font-semibold"},G={class:"text-md text-grey-400 leading-4"},J={class:"text-grey font-semibold"},K={key:0},Q={key:1,class:"flex flex-col text-left items-center"},X={key:0,class:"flex flex-col items-stretch sm:min-w-[40vw] md:min-w-[30vw] min-w-full"},Y={class:"flex justify-center"},ee=`aws iam get-role --role-name Canarytokens-Inventory-ReadOnly-Role --query 'Role.AssumeRolePolicyDocument.Statement[0].Condition.StringEquals."sts:ExternalId"' --output text`,te=E({__name:"CheckAwsPermission",props:{initialStepData:{},currentStepData:{}},emits:["updateStep","storeCurrentStepData"],setup(h,{emit:y}){const k=y,w=h,{token:se,auth_token:ae,aws_region:C,aws_account_number:S}=w.initialStepData,s=l(!1),a=l(!1),_=l(""),p=l(""),f=l("");R(async()=>{p.value=S,f.value=C});const b=W().shape({external_id:q().required("The external ID is required")});async function v(){_.value="",s.value=!0,k("updateStep")}async function D(){await v()}return(oe,t)=>{const I=V,A=T,B=P,x=L;return o(),i("section",F,[e("div",O,[e("h2",null,u(s.value?"Checking permission...":"Check your AWS permission"),1),!s.value&&!a.value?(o(),i("div",H,[c(I,{class:"p-16 mt-16 flex flex-col gap-8 items-center"},{default:m(()=>[e("img",{src:d(N)("token_icons/aws_infra.png"),alt:"asw-token-icon",class:"w-[4.5rem] h-[4.5rem]"},null,8,U),e("p",Z,[t[0]||(t[0]=n(" AWS account: ")),e("span",z,u(p.value),1)]),e("p",G,[t[1]||(t[1]=n(" AWS region: ")),e("span",J,u(f.value),1)])]),_:1})])):r("",!0)]),!s.value&&!a.value?(o(),i("div",K,t[2]||(t[2]=[e("p",{class:"text-gray-700"},[n(" In order to proceed we need you to confirm the "),e("b",null,"External ID"),n(" for our role."),e("br"),n(" Run the AWS CLI command below to find the External ID ")],-1)]))):r("",!0),!s.value&&!a.value?(o(),i("div",Q,[c(A,{lang:"bash",label:"AWS CLI snippet",code:ee,"custom-height":"100px",class:"mt-24 wrap-code lg:max-w-[50vw]","check-scroll":!0}),!s.value&&!a.value?(o(),i("div",X,[c(d($),{class:"mt-24 flex flex-col gap-16 items-center","validation-schema":d(b),onSubmit:D},{default:m(()=>[c(B,{id:"external_id",label:"Add your External ID",placeholder:"e.g. abCd7Lb6cEZrMCEm3OAoj",required:"",class:"min-w-full"}),c(x,{type:"submit",variant:"primary"},{default:m(()=>t[3]||(t[3]=[n("Check permissions")])),_:1})]),_:1},8,["validation-schema"])])):r("",!0)])):r("",!0),s.value||a.value?(o(),g(j,{key:2,"is-loading":s.value,"is-error":a.value,"loading-message":"We are checking the permissions, hold on","error-message":_.value},null,8,["is-loading","is-error","error-message"])):r("",!0),e("div",Y,[a.value?(o(),g(x,{key:0,class:"mt-40",variant:"secondary",onClick:v},{default:m(()=>t[4]||(t[4]=[n(" Try again ")])),_:1})):r("",!0)])])}}}),de=M(te,[["__scopeId","data-v-a2678cc0"]]);export{de as default};
