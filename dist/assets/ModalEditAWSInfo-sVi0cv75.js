import{d as B,r as n,aB as C,aC as g,o as W,e as b,f as h,w as s,k as i,i as r,l as m,aK as D,v as _,M,j as $,C as q,D as E,E as F}from"./index-DatEjxfX.js";import{_ as N}from"./BaseFormSelect.vue_vue_type_style_index_0_lang-BdeIvx6p.js";import{_ as V}from"./BaseFormTextField.vue_vue_type_style_index_0_lang-17_lGWXO.js";import{A as w}from"./constants-leaU8Fgz.js";import{f as I}from"./awsInfra-GRFw5Phc.js";import"./BaseLabelArrow.vue_vue_type_style_index_0_lang-BJreSw0P.js";import"./BaseLabel.vue_vue_type_script_setup_true_lang-XW0qcsN8.js";const R={class:"min-w-[250px] lg:w-[30vw] max-w-[400px]"},j={class:"lg:basis-6/12"},T={class:"flex flex col justify-center gap-8 mt-24"},P=B({__name:"ModalEditAWSInfo",props:{tokenData:{},closeModal:{type:Function},saveData:{type:Function}},setup(S){const t=S,f=n([]),p=n(""),l=n(!1),u=n(!1),d=n(""),k=C().shape({aws_region:g().required("AWS region is required"),aws_account_number:g().required("AWS account number is required").matches(/^\d+$/,"AWS account must be a number").test("len","AWS account number must have 12 digits",e=>e.length===12)});W(()=>{f.value=w.filter(e=>e.value===t.tokenData.aws_region),p.value=t.tokenData.aws_account_number});async function y(e){var a,c;l.value=!0;try{const o=await I(t.tokenData.token,t.tokenData.auth_token,e.aws_account_number,e.aws_region);o.status!==200&&(u.value=!0,d.value=o.data.message||"Canarytoken can't be edited."),t.saveData(e),t.closeModal()}catch(o){u.value=!0,d.value=((c=(a=o.response)==null?void 0:a.data)==null?void 0:c.message)||"Canarytoken can't be edited."}finally{l.value=!1}}return(e,a)=>{const c=V,o=N,x=q,v=E,A=F;return b(),h(A,{title:"Edit account information","has-close-button":!0,"hide-footer":!0},{default:s(()=>[i("div",R,[r(m(D),{class:"flex flex-col","validation-schema":m(k),onSubmit:y},{default:s(()=>[i("div",j,[r(c,{id:"aws_account_number",type:"text",placeholder:"e.g. 012345678901",label:"AWS account number","full-width":"",required:"",value:p.value},null,8,["value"]),i("div",null,[r(o,{id:"aws_region",label:"AWS Region",options:m(w),placeholder:"Select AWS region",required:"",searchable:"",value:f.value[0]},null,8,["options","value"])])]),u.value?(b(),h(x,{key:0,variant:"danger"},{default:s(()=>[_(M(d.value),1)]),_:1})):$("",!0),i("div",T,[r(v,{variant:"grey",onClick:e.closeModal},{default:s(()=>a[0]||(a[0]=[_("Cancel")])),_:1},8,["onClick"]),r(v,{variant:"primary",type:"submit",loading:l.value},{default:s(()=>a[1]||(a[1]=[_("Save")])),_:1},8,["loading"])])]),_:1},8,["validation-schema"])])]),_:1})}}});export{P as default};
