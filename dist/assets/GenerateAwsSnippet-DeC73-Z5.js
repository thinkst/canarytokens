const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ModalEditAWSInfo-BwEooPSw.js","assets/index-CVx3_slE.js","assets/index-B4syrpq9.css","assets/BaseFormSelect.vue_vue_type_style_index_0_lang-DyYW3zQy.js","assets/BaseFormSelect-CntJSWeK.css","assets/BaseFormTextField.vue_vue_type_style_index_0_lang-C3M8lqtY.js","assets/BaseLabel.vue_vue_type_script_setup_true_lang-BxRQFccT.js","assets/BaseFormTextField-DPA1rF03.css","assets/constants-DJ0HIoY4.js","assets/awsInfra-DAo_AsVB.js"])))=>i.map(i=>d[i]);
import{d as M,e as s,h as d,O,V as j,M as y,H as L,r as p,o as Q,k as o,i as $,w as _,l as z,m as F,v as l,j as r,f as m,F as H,D as U,C as Y,b as J,c as K}from"./index-CVx3_slE.js";import{_ as X}from"./BaseCodeSnippet.vue_vue_type_script_setup_true_lang-5L0UGysc.js";import{_ as Z}from"./BaseCard-FWdKLBGT.js";import{r as ee}from"./awsInfra-DAo_AsVB.js";import{_ as te}from"./StepState.vue_vue_type_script_setup_true_lang-VwHdhTox.js";import"./BaseCopyButton-CBuQ4QqG.js";const ae={class:"flex flex-col w-full gap-16 my-16 items-left text-grey-800"},se=M({__name:"BaseBulletList",props:{list:{}},setup(x){const k=x;return(b,f)=>(s(),d("ul",ae,[(s(!0),d(O,null,j(k.list,u=>(s(),d("li",{key:u,class:"grid justify-start grid-flow-col gap-8 px-16 py-8 text-left bg-white border rounded-2xl border-grey-200 text-grey-500"},y(u),1))),128))]))}}),ne=L(se,[["__scopeId","data-v-bc3aeab4"]]),oe={class:"flex text-center flex-col"},re={class:"infra-token__title-wrapper flex flex-col items-center"},le={key:0},ie=["src"],ue={class:"text-md text-grey-400 leading-4"},ce={class:"text-grey font-semibold"},pe={class:"text-md text-grey-400 leading-4"},de={class:"text-grey font-semibold"},me={key:0},_e={class:"text-gray-700"},fe={class:"text-grey font-bold"},ve={key:2,class:"flex items-center flex-col text-left"},ge={key:2},ye={class:"mt-24 flex flex-col items-center"},Se={class:"flex justify-center"},we=M({__name:"GenerateAwsSnippet",props:{initialStepData:{},currentStepData:{}},emits:["updateStep","storeCurrentStepData","storePreviousStepData"],setup(x,{emit:k}){const b=J(()=>K(()=>import("./ModalEditAWSInfo-BwEooPSw.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]))),f=k,u=x,{token:D,auth_token:B,aws_region:R,aws_account_number:xe}=u.initialStepData,a=p(!0),n=p(!1),S=p(""),v=p(""),w=p(""),h=p(""),I=p(!1),g=p(!1);Q(async()=>{w.value=u.initialStepData.aws_account_number,h.value=u.initialStepData.aws_region;const t=u.currentStepData.codeSnippetCommands;t?(n.value=!1,a.value=!1,v.value=t):await E()});async function E(){a.value=!0,n.value=!1;try{const t=await ee(D,B,R);t.status!==200&&(a.value=!1,n.value=!0,t.data.error_message=S),a.value=!1,t.data.role_setup_commands||(a.value=!1,n.value=!0,S.value="Something went wrong when we tried to generate your snippet. Please try again.");const e=t.data.role_setup_commands.aws_account,c=t.data.role_setup_commands.customer_aws_account,i=t.data.role_setup_commands.external_id,C=t.data.role_setup_commands.role_name,A=N(e,c,i,C);v.value=A,f("storeCurrentStepData",{token:D,auth_token:B,codeSnippetCommands:v.value})}catch(t){n.value=!0,a.value=!1,S.value=t}finally{a.value=!1}}function V(){const{open:t,close:e}=H({component:b,attrs:{closeModal:()=>e(),saveData:c=>P(c),initialStepData:u.initialStepData}});t()}function P(t){f("storePreviousStepData",t),w.value=t.aws_account_number,h.value=t.aws_region}function W(){I.value=!0}function G(){I.value?(g.value=!1,f("updateStep")):g.value=!0}const T=["This step grants Canarytokens.org temporary, read-only access to list names of various AWS resources (S3 buckets, SQS queues, SSM parameters, Secrets Manager secrets, DynamoDB tables, and IAM roles) to create a customized infrastructure plan.","This access is automatically revoked by Canarytokens.org after plan creation.","You will be provided with cleanup instructions at the end of the wizard to remove the associated AWS policy, attachment, and role."];function N(t,e,c,i){return`aws iam create-role --role-name ${i} --assume-role-policy-document '{"Version": "2012-10-17", "Statement": [{"Effect": "Allow", "Principal": {"AWS": "arn:aws:sts::${t}:assumed-role/InventoryManagerRole/${c}"}, "Action": "sts:AssumeRole", "Condition": {"StringEquals": {"sts:ExternalId": "${c}"}}}]}'

aws iam create-policy --policy-name Canarytokens-Inventory-ReadOnly-Policy --policy-document '{"Version": "2012-10-17","Statement": [{"Effect": "Allow","Action": ["sqs:ListQueues","sqs:GetQueueAttributes"],"Resource": "*"},{"Effect": "Allow","Action": ["s3:ListAllMyBuckets"],"Resource": "*"}]}'

aws iam attach-role-policy --role-name ${i} --policy-arn arn:aws:iam::${e}:policy/Canarytokens-Inventory-ReadOnly-Policy
`}return(t,e)=>{const c=Z,i=U,C=X,A=ne,q=Y;return s(),d("section",oe,[o("div",re,[o("h2",null,y(a.value?"Generating AWS Snippet...":"Setup AWS role and policy"),1),!a.value&&!n.value?(s(),d("div",le,[$(c,{class:"p-16 mt-16 flex flex-col gap-8 items-center"},{default:_(()=>[o("img",{src:z(F)("token_icons/aws_infra.png"),alt:"asw-token-icon",class:"w-[4.5rem] h-[4.5rem]"},null,8,ie),o("p",ue,[e[1]||(e[1]=l(" AWS account: ")),o("span",ce,y(w.value),1)]),o("p",pe,[e[2]||(e[2]=l(" AWS region: ")),o("span",de,y(h.value),1)])]),_:1}),$(i,{variant:"text",onClick:V},{default:_(()=>e[3]||(e[3]=[l("Incorrect information? Edit")])),_:1})])):r("",!0)]),!a.value&&!n.value?(s(),d("div",me,[o("p",_e,[e[4]||(e[4]=l(" Ensure your environment is configured to access the AWS account ")),o("span",fe,y(w.value),1),e[5]||(e[5]=l()),e[6]||(e[6]=o("br",null,null,-1)),e[7]||(e[7]=l(" Then run the AWS CLI snippet below "))])])):r("",!0),a.value||n.value?(s(),m(te,{key:1,"is-loading":a.value,"is-error":n.value,"loading-message":"We are generating the snippet, hold on","error-message":S.value},null,8,["is-loading","is-error","error-message"])):r("",!0),!a.value&&!n.value?(s(),d("div",ve,[v.value?(s(),m(C,{key:0,lang:"bash",label:"AWS CLI snippet",code:v.value,"custom-height":"100px",class:"md:max-w-[600px] max-w-[350px] mt-24 wrap-code","check-scroll":!0,onCopyContent:W,onSnippetScrolled:W},null,8,["code"])):r("",!0),!a.value&&!n.value?(s(),m(A,{key:1,list:T,class:"md:max-w-[600px] max-w-[350px] mt-24 wrap-code"})):r("",!0),!a.value&&!n.value?(s(),d("div",ge,[o("div",ye,[g.value?(s(),m(q,{key:0,variant:"warning",class:"mb-16"},{default:_(()=>e[8]||(e[8]=[l(" Make sure to run the command above. Otherwise, the next step will lead to an error, preventing you from continuing. ")])),_:1})):r("",!0),g.value?r("",!0):(s(),m(i,{key:1,onClick:G},{default:_(()=>e[9]||(e[9]=[l(" Continue ")])),_:1})),g.value?(s(),m(i,{key:2,onClick:e[0]||(e[0]=ke=>f("updateStep"))},{default:_(()=>e[10]||(e[10]=[l(" I Ran the Command, Continue ")])),_:1})):r("",!0)])])):r("",!0)])):r("",!0),o("div",Se,[n.value?(s(),m(i,{key:0,class:"mt-40",variant:"secondary",onClick:E},{default:_(()=>e[11]||(e[11]=[l(" Try again ")])),_:1})):r("",!0)])])}}}),Ie=L(we,[["__scopeId","data-v-91c8087a"]]);export{Ie as default};
